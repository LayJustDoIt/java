<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<?xml-stylesheet type="text/xsl" href="SpecialDB.xslt"?>

<sqlMap namespace="Person">

	<typeAlias alias="Person" type="org.lr.ibatis.bean.Person" />
	
	<cacheModel id="person-cache" type="OSCACHE">
		<flushInterval hours="24" />
		<flushOnExecute statement="insertPerson" />
		<property name="size" value="1000" />
	</cacheModel>
	
	<select id="queryAll" resultClass="Person" cacheModel="person-cache">
		select * from person
	</select>

	<select id="queryById" parameterClass="java.lang.String"
		resultClass="Person">
		select * from person where id=#id#
	</select>
	
	<update id="updatePerson" parameterClass="org.lr.ibatis.bean.Person">
		update person set 
	    <dynamic prepend=" ">
            <isNotNull prepend="," property="name">name = #name#</isNotNull>
            <isNotNull prepend="," property="info">info = #info#</isNotNull>
            , info_blob = #info_blob#
        </dynamic>
        where id = #id#
	</update>
	
	<insert id="insertPerson" parameterClass="org.lr.ibatis.bean.Person">
         insert
          into person (
        <dynamic prepend=" ">
            <isNotNull prepend="," property="id">id</isNotNull>
            <isNotNull prepend="," property="name">name</isNotNull>
            <isNotNull prepend="," property="info">info</isNotNull>
            <isNotNull prepend="," property="info_blob">info_blob</isNotNull>
        </dynamic>
          )
        values (
        <dynamic prepend=" ">
            <isNotNull prepend="," property="id">#id:INT#</isNotNull>
            <isNotNull prepend="," property="name">#name:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="info">#info:VARCHAR#</isNotNull>
            <isNotNull prepend="," property="info_blob">#info_blob:BLOB#</isNotNull>
        </dynamic>
        ) 
       <!-- insert
          into person (id, name, info, info_blob) values (#id#,#name#,#info#,#info_blob#)  -->
    </insert>

</sqlMap>
